<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      color: #333;
    }
    h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      padding: 0.75rem;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
    .status {
      font-weight: bold;
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      display: inline-block;
    }
    .status.start { background: #fff9c4; }
    .status.ongoing { background: #dcedc8; }
    .status.done { background: #c8e6c9; }
    .progress-bar {
      height: 16px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: #007bff;
    }
    button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: green;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-btn {
      color: red;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h2>

<input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô..." style="padding: 0.5rem; margin-bottom: 1rem; width: 100%; max-width: 300px;">
<button onclick="addTask()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>

<table>
  <thead>
    <tr>
      <th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</th>
      <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</th>
      <th>‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
      <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô)</th>
      <th>% ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
      <th>Progress</th>
      <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      <th>‡∏•‡∏ö</th>
    </tr>
  </thead>
  <tbody id="taskTable"></tbody>
</table>

<script>
let tasks = [
  {
    project: "‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô",
    startDate: "2025-05-25",
    endDate: "2025-05-30",
    duration: 5,
    progressPercent: 0,
    status: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô"
  },
  {
    project: "‡∏Ç‡∏≤‡∏¢‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ",
    startDate: "2025-05-27",
    endDate: "2025-05-31",
    duration: 4,
    progressPercent: 100,
    status: "‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î"
  }
];

const tbody = document.getElementById("taskTable");

function renderTasks(data) {
  tbody.innerHTML = "";
  data.forEach((task, index) => {
    const tr = document.createElement("tr");
    const statusClass = task.status.includes("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°") ? "start"
                      : task.status.includes("‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î") ? "ongoing"
                      : "done";
    tr.innerHTML = `
      <td>${task.project}</td>
      <td>${new Date(task.startDate).toLocaleDateString()}</td>
      <td>${new Date(task.endDate).toLocaleDateString()}</td>
      <td>${task.duration}</td>
      <td>${task.progressPercent.toFixed(2)}%</td>
      <td><div class="progress-bar"><div class="progress-fill" style="width: ${Math.min(task.progressPercent, 100)}%"></div></div></td>
      <td><span class="status ${statusClass}">${task.status}</span></td>
      <td><span class="delete-btn" onclick="deleteTask(${index})">üóëÔ∏è</span></td>
    `;
    tbody.appendChild(tr);
  });
}

function addTask() {
  const project = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå:");
  const start = prompt("‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (YYYY-MM-DD):");
  const end = prompt("‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (YYYY-MM-DD):");
  const duration = Math.ceil((new Date(end) - new Date(start)) / (1000 * 60 * 60 * 24));
  const progress = Number(prompt("% ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤:", 0));
  const status = prompt("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô / ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î):");

  const newTask = { project, startDate: start, endDate: end, duration, progressPercent: progress, status };
  tasks.push(newTask);
  renderTasks(tasks);

  // üîÅ ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet
  fetch("https://script.google.com/macros/s/AKfycbyM-OkQ3hlpe_s7WVZbp6Xpdv0ht0lqYJfdCJm71u7PRssVU6pFuEAr-lMIiqF9JStw/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(newTask)
  })
  .then(res => res.text())
  .then(msg => alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡πÅ‡∏•‡πâ‡∏ß: " + msg))
  .catch(err => alert("‚ùå Error: " + err.message));
}

function deleteTask(index) {
  if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?")) {
    tasks.splice(index, 1);
    renderTasks(tasks);
  }
}

renderTasks(tasks);

document.getElementById("search").addEventListener("input", (e) => {
  const keyword = e.target.value.toLowerCase();
  const filtered = tasks.filter(t => t.project.toLowerCase().includes(keyword));
  renderTasks(filtered);
});
</script>
</body>
</html>
